window.__require=function e(t,i,o){function n(a,c){if(!i[a]){if(!t[a]){var r=a.split("/");if(r=r[r.length-1],!t[r]){var h="function"==typeof __require&&__require;if(!c&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var l=i[a]={exports:{}};t[a][0].call(l.exports,function(e){return n(t[a][1][e]||e)},l,l.exports,e,t,i,o)}return i[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<o.length;a++)n(o[a]);return n}({configManager:[function(e,t,i){"use strict";cc._RF.push(t,"5dd2f/mh0hKZ5QpfcoyO6sB","configManager");var o=e("global");cc.Class({extends:cc.Component,properties:{config:cc.JsonAsset},onLoad:function(){o.config=this,this.configData=this.config.json},start:function(){},getShapes:function(){return this.configData.shapes},getRotations:function(){return this.configData.rotations},getsingleBlockSize:function(){return this.configData.singleBlockSize}}),cc._RF.pop()},{global:"global"}],dataManager:[function(e,t,i){"use strict";cc._RF.push(t,"36ec5TYaxxExLKEmFQypR1m","dataManager"),t.exports=function(){var e=new Object;return e.userData={},e.load=function(){var t=cc.sys.localStorage.getItem("userData");e.userData=null!=t&&""!=t?JSON.parse(t):{score:0}},e.save=function(){var t=JSON.stringify(e.userData);cc.sys.localStorage.setItem("userData",t)},e.updateScore=function(t){e.userData.score=t,e.save()},e.getScore=function(){return null==e.userData.score&&(e.userData.score=0),e.userData.score},e},cc._RF.pop()},{}],failed:[function(e,t,i){"use strict";cc._RF.push(t,"2c881TQNENFEJ5Az8b2GIau","failed");var o=e("global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){o.failed=this,this.node.zIndex=9999,this.node.active=!1},start:function(){},show:function(){this.node.active=!0,cc.log("failed")},restart:function(){o.sourceArea.destroyAll(),o.placedArea.destroyAll(),o.sourceArea.refreshShapes(),this.node.active=!1}}),cc._RF.pop()},{global:"global"}],game:[function(e,t,i){"use strict";cc._RF.push(t,"2dde2R24ANMqY4Z26aVguBe","game");var o=e("global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.loader.loadResDir("prefab/gameUI",function(e,t){this.loadGameUI(t),this.registerFailedAction()}.bind(this))},start:function(){},loadGameUI:function(e){for(var t=0;t<e.length;t++){var i=cc.instantiate(e[t]);this.node.addChild(i)}},registerFailedAction:function(){o.movedArea.registerTouchEndEvent(function(){for(var e=o.sourceArea.getShapes(),t=0;t<e.length;t++)if(null!=e[t]&&o.placedArea.canPlaced(e[t].data.checklist))return;o.failed.show()})}}),cc._RF.pop()},{global:"global"}],global:[function(e,t,i){"use strict";cc._RF.push(t,"c04f1TIcE9JSY6cC6EVg8KX","global"),t.exports={config:null,shapeBuilder:null,sourceArea:null,placedArea:null,movedArea:null,top:null,bottom:null,failed:null},cc._RF.pop()},{}],movedArea:[function(e,t,i){"use strict";cc._RF.push(t,"66268ITDi1AAqpuW96AJdbB","movedArea");var o=e("global");cc.Class({extends:cc.Component,properties:{space:{default:100,type:cc.Integer}},onLoad:function(){o.movedArea=this,this.touchEndActions=new Array,this.node.zIndex=999,this.movingElement=null,this.currentType,cc.macro.ENABLE_MULTI_TOUCH=!1,this.node.on("touchstart",this.touchStart,this),this.node.on("touchmove",this.touchMove,this),this.node.on("touchend",this.touchEnd,this),this.node.on("touchcancel",this.touchCancel,this)},start:function(){this.singleBlockSize=o.config.getsingleBlockSize()},touchStart:function(e){this.destroyMovingElement();var t=e.getLocation();o.sourceArea.isInside(t)?(this.currentType="shape",this.movingElement=this.createMovingShape(t),this.node.addChild(this.movingElement.node),o.sourceArea.hideShape(this.movingElement.sourceIndex)):cc.log("no")},touchMove:function(e){if(null!=this.movingElement){var t=e.getLocation();t=this.node.convertToNodeSpaceAR(t),this.movingElement.node.x=t.x,this.movingElement.node.y=t.y+this.singleBlockSize.height*this.movingElement.data.height/2+this.space}},touchEnd:function(e){null!=this.movingElement&&("shape"==this.currentType&&this.processShape(),this.destroyMovingElement())},touchCancel:function(e){null!=this.movingElement&&(o.sourceArea.showShape(this.movingElement.sourceIndex),this.destroyMovingElement())},destroyMovingElement:function(){null!=this.movingElement&&(this.movingElement.node.removeFromParent(),this.movingElement.node=null,this.movingElement=null)},createMovingShape:function(e){var t=new Object,i=o.sourceArea.getShape(e);e=this.node.convertToNodeSpaceAR(e),t.data=i.data,t.sourceIndex=i.sourceIndex,t.node=cc.instantiate(i.node),t.node.scale=.95;var n=o.sourceArea.node.width/3;return t.node.x=i.sourceIndex*n+n/2,t.node.y=e.y+this.singleBlockSize.height*i.data.height/2+this.space,t},processShape:function(){var e=this.movingElement.node.getPosition();e=this.node.convertToWorldSpaceAR(e),o.placedArea.place(e,this.movingElement.data)?(o.sourceArea.destroyShape(this.movingElement.sourceIndex),this.doTouchEndAction()):o.sourceArea.showShape(this.movingElement.sourceIndex)},registerTouchEndEvent:function(e){this.touchEndActions.push(e)},doTouchEndAction:function(){for(var e=0;e<this.touchEndActions.length;e++)this.touchEndActions[e]()}}),cc._RF.pop()},{global:"global"}],placedArea:[function(e,t,i){"use strict";cc._RF.push(t,"f0cd2x/3BlMybTD48NS98RM","placedArea");var o=e("global");cc.Class({extends:cc.Component,properties:{rowCount:{default:10,type:cc.Integer},colCount:{default:10,type:cc.Integer},placedElement:cc.Prefab,placedBlock:cc.Prefab},onLoad:function(){o.placedArea=this,this.placedMap=new Array},start:function(){this.singleBlockSize=o.config.getsingleBlockSize(),this.spaceX=this.singleBlockSize.width/2,this.spaceY=this.singleBlockSize.height/2,this.loadPlacedBlocks()},loadPlacedBlocks:function(){for(var e=0;e<this.rowCount;e++){for(var t=new Array,i=0;i<this.colCount;i++){var o=this.createPlacedBlock(this.singleBlockSize.width,this.singleBlockSize.height,e,i);this.node.addChild(o);var n=this.createChild(o);o.addChild(n),n.active=!1,t[i]=o}this.placedMap[e]=t}},createPlacedBlock:function(e,t,i,o){var n=cc.instantiate(this.placedBlock);return n.width=e,n.height=t,n.x=o*e,n.y=-i*t,n},createChild:function(e){var t=cc.instantiate(this.placedElement);return t.width=e.width-6,t.height=e.height-6,t.x=3,t.y=-3,t},place:function(e,t){e=this.node.convertToNodeSpaceAR(e);var i=t.width,o=t.height;if(!this.validateArea(e,i,o))return!1;e=this.resetPosition(e,i,o);var n=this.getPlacedPosition(t.center,e,t.checklist);return!!this.validateSpace(n)&&(this.placeElement(n),this.clearFulled(n),!0)},validateArea:function(e,t,i){return e.x-t/2*this.singleBlockSize.width>=-this.spaceX&&e.x+t/2*this.singleBlockSize.width<=this.spaceX+this.node.width&&e.y+i/2*this.singleBlockSize.height<=this.spaceY&&e.y-i/2*this.singleBlockSize.height>=-this.spaceY-this.node.height},resetPosition:function(e,t,i){return e.x=this.resetPositionX(e.x,t),e.y=this.resetPositionY(e.y,i),e},resetPositionX:function(e,t){var i=0;t%2==0?i=e%this.singleBlockSize.width>=this.singleBlockSize.width/2?Math.ceil(e/this.singleBlockSize.width):Math.floor(e/this.singleBlockSize.width):i=Math.floor(e/this.singleBlockSize.width)+.5;return i*this.singleBlockSize.width},resetPositionY:function(e,t){var i=0;t%2==0?i=e%this.singleBlockSize.height<=-this.singleBlockSize.height/2?Math.floor(e/this.singleBlockSize.height):Math.ceil(e/this.singleBlockSize.height):i=Math.ceil(e/this.singleBlockSize.height)-.5;return i*this.singleBlockSize.height},getOffset:function(e,t){return{col:(t.x-e.x*this.singleBlockSize.width)/this.singleBlockSize.width,row:(e.y*this.singleBlockSize.height-t.y)/this.singleBlockSize.height}},validateSpace:function(e){for(var t=e.rows,i=e.cols,o=0;o<t.length;o++)if(this.placedMap[t[o]][i[o]].children[0].active)return!1;return!0},placeElement:function(e){for(var t=e.rows,i=e.cols,n=0;n<t.length;n++)this.placedMap[t[n]][i[n]].children[0].active=!0,o.top.addScore(1)},getPlacedPosition:function(e,t,i){for(var o=new Array,n=new Array,s=this.getOffset(e,t),a=0;a<i.length;a++){var c=i[a],r=c.row+s.row,h=c.col+s.col;o.push(r),n.push(h)}return{rows:o,cols:n}},clearFulled:function(e){for(var t=this.getNeedToClearPositions(e.rows,e.cols),i=0;i<t.rows.length;i++)this.clearRow(t.rows[i]);for(var o=0;o<t.cols.length;o++)this.clearCol(t.cols[o])},getNeedToClearPositions:function(e,t){for(var i=new Array,o=new Array,n=0;n<e.length;n++)this.isRowFull(e[n])&&!array_contain(i,e[n])&&i.push(e[n]),this.isColFull(t[n])&&!array_contain(o,t[n])&&o.push(t[n]);return{rows:i,cols:o}},isRowFull:function(e){for(var t=0;t<this.colCount;t++)if(!this.placedMap[e][t].children[0].active)return!1;return!0},clearRow:function(e){for(var t=0;t<this.colCount;t++)this.placedMap[e][t].children[0].active=!1},isColFull:function(e){for(var t=0;t<this.colCount;t++)if(!this.placedMap[t][e].children[0].active)return!1;return!0},clearCol:function(e){for(var t=0;t<this.colCount;t++)this.placedMap[t][e].children[0].active=!1},canPlaced:function(e){for(var t=0;t<this.rowCount;t++)for(var i=0;i<this.colCount;i++)if(!(this.placedMap[t][i].children[0].active||t<e[0].row||i<e[0].col)){for(var o=t-e[0].row,n=i-e[0].col,s=!0,a=1;a<e.length;a++){var c=e[a].row+o,r=e[a].col+n;if(c>=this.rowCount||r>=this.colCount||this.placedMap[c][r].children[0].active){s=!1;break}}if(s)return!0}return!1},destroyAll:function(){for(var e=0;e<this.rowCount;e++)for(var t=0;t<this.colCount;t++)this.placedMap[e][t].children[0].active=!1}}),cc._RF.pop()},{global:"global"}],shapeBuilder:[function(e,t,i){"use strict";cc._RF.push(t,"bd2dfbUrVRL7oIvsK7Cznw9","shapeBuilder");var o=e("global");cc.Class({extends:cc.Component,properties:{shapePool:[cc.Prefab]},onLoad:function(){o.shapeBuilder=this,this.calcProbability=new Array,this.maxProbability=0},start:function(){this.shapesData=o.config.getShapes(),this.rotations=o.config.getRotations(),this.initializeCalcProbability()},initializeCalcProbability:function(){for(var e=0;e<this.shapesData.length;e++)this.maxProbability+=this.shapesData[e].probability,0==e?this.calcProbability.push(this.shapesData[e].probability):this.calcProbability.push(this.calcProbability[e-1]+this.shapesData[e].probability)},createShape:function(){var e=this.createTypeByProbability(),t=randomNum(0,this.rotations.length-1),i=new Object;return i.data=this.shapesData[e].positions[t],i.node=this.createNode(e,t,i.data),i},createNode:function(e,t){var i=cc.instantiate(this.shapePool[e]);return i.rotation=this.rotations[t],i.active=!0,i},createTypeByProbability:function(){for(var e=randomNum(0,this.maxProbability),t=0;t<this.calcProbability.length;t++)if(e<=this.calcProbability[t])return t;return 0}}),cc._RF.pop()},{global:"global"}],sourceArea:[function(e,t,i){"use strict";cc._RF.push(t,"2b5a1veXRlBdppubFdPu2KE","sourceArea");var o=e("global");cc.Class({extends:cc.Component,properties:{blockNum:{default:3,type:cc.Integer}},onLoad:function(){o.sourceArea=this,this.shapes=new Array,this.loadArea()},start:function(){},loadArea:function(){cc.loader.loadRes("prefab/block",function(e,t){for(var i=this.node.width/this.blockNum,o=this.node.height,n=0;n<this.blockNum;n++){var s=cc.instantiate(t);s.width=i,s.height=o,s.x=n*i,this.node.addChild(s),this.addShape(s,n)}}.bind(this))},addShape:function(e,t){var i=o.shapeBuilder.createShape();i.sourceIndex=t,i.node.x=this.node.width/this.blockNum/2,i.node.y=-this.node.height/2,this.shapes[t]=i,i.node.scale=.5,e.addChild(i.node)},isInside:function(e){var t=this.node.convertToNodeSpaceAR(e);return t.x>=0&&t.x<=this.node.width&&t.y<=0&&t.y>=-this.node.height},getShape:function(e){var t=this.node.convertToNodeSpaceAR(e),i=Math.floor(t.x/(this.node.width/this.blockNum));return this.shapes[i]},hideShape:function(e){e<0||e>=this.blockNum||(this.shapes[e].node.active=!1)},showShape:function(e){e<0||e>=this.blockNum||(this.shapes[e].node.active=!0)},destroyShape:function(e){e<0||e>=this.blockNum||null==this.shapes[e]||(this.shapes[e].node.removeFromParent(),this.shapes[e].node=null,this.shapes[e]=null,this.isNeedRefresh()&&this.refreshShapes())},isNeedRefresh:function(){for(var e=0;e<this.shapes.length;e++)if(null!=this.shapes[e])return!1;return!0},refreshShapes:function(){for(var e=0;e<this.node.children.length;e++)this.addShape(this.node.children[e],e)},getShapes:function(){return this.shapes},clearShapes:function(){for(var e=0;e<this.shapes.length;e++)null!=this.shapes[e]&&(this.shapes[e].node.removeFromParent(),this.shapes[e].node=null,this.shapes[e]=null)},destroyAll:function(){this.clearShapes()}}),cc._RF.pop()},{global:"global"}],testGroup:[function(e,t,i){"use strict";cc._RF.push(t,"13e715i6k9K15x4WM/G+GAe","testGroup");var o=e("global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){},onClickCreateShape:function(){var e=o.shapeBuilder.createShape();this.node.addChild(e.node)},onClickGetShape:function(){var e=o.sourceArea.getShape();this.node.addChild(e.node)}}),cc._RF.pop()},{global:"global"}],top:[function(e,t,i){"use strict";cc._RF.push(t,"b52627zJ59NaLfcnCQhcqRP","top");var o=e("global"),n=e("dataManager");cc.Class({extends:cc.Component,properties:{scoreLabel:cc.Label,scoreHistoryLabel:cc.Label},onLoad:function(){o.top=this,this.dataManager=n(),this.scoreNum=this.scoreHistoryNum=0},start:function(){this.dataManager.load(),this.loadHistoryScore()},onClickSetting:function(){this.showSettingModel()},addScore:function(e){this.scoreNum+=e,this.scoreLabel.string=this.scoreNum+"",this.scoreNum>this.scoreHistoryNum&&this.updateScoreHistory()},updateScoreHistory:function(){this.scoreHistoryNum=this.scoreNum,this.scoreHistoryLabel.string=this.scoreHistoryNum+"",this.dataManager.updateScore(this.scoreHistoryNum)},loadHistoryScore:function(){this.scoreHistoryNum=this.dataManager.getScore(),this.scoreHistoryLabel.string=this.scoreHistoryNum+""},showSettingModel:function(){o.failed.show()}}),cc._RF.pop()},{dataManager:"dataManager",global:"global"}],weicome:[function(e,t,i){"use strict";cc._RF.push(t,"768a9IKRSRK26HvmuxrdwR1","weicome"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.director.preloadScene("game",function(){cc.log("Next scene preloaded")})},start:function(){},onClickStartGame:function(){cc.director.loadScene("game")}}),cc._RF.pop()},{}]},{},["configManager","dataManager","failed","game","global","movedArea","placedArea","shapeBuilder","sourceArea","testGroup","top","weicome"]);