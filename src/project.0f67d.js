window.__require=function t(e,o,i){function a(n,r){if(!o[n]){if(!e[n]){var c=n.split("/");if(c=c[c.length-1],!e[c]){var h="function"==typeof __require&&__require;if(!r&&h)return h(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+n+"'")}n=c}var l=o[n]={exports:{}};e[n][0].call(l.exports,function(t){return a(e[n][1][t]||t)},l,l.exports,t,e,o,i)}return o[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<i.length;n++)a(i[n]);return a}({backlogGroup:[function(t,e,o){"use strict";cc._RF.push(e,"87752eeZy1Gqa4kHeXOAgp2","backlogGroup"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){window.g_backlogGroup=this,this.m_shapes=[],this.node.on("touchstart",this.touchStart,this),this.node.on("touchmove",this.touchMove,this),this.node.on("touchend",this.touchEnd,this),this.node.on("touchcancel",this.touchCancel,this)},start:function(){this.createShape()},createShape:function(){for(var t=0;t<this.node.children.length;t++){var e=g_shapeBuilder.createShape();e.node.scale=0,this.node.children[t].addChild(e.node),e.node.runAction(cc.scaleTo(.3,.5)),this.m_shapes[t]=e}},getCurrentShap:function(t){return t.y>0||t.y<-213||t.x<0||t.x>640?null:(this.m_currentIndex=Math.floor(t.x/213),this.m_shapes[this.m_currentIndex])},clearMoveShape:function(){null!=this.m_moveShap&&(this.m_moveShap.node.removeFromParent(),this.m_moveShap=null)},clearCurrentShape:function(){var t=this.m_shapes[this.m_currentIndex];null!=t&&(t.node.removeFromParent(),this.m_shapes[this.m_currentIndex]=null)},createNewShapes:function(){null==this.m_shapes[0]&&null==this.m_shapes[1]&&null==this.m_shapes[2]&&this.createShape()},touchStart:function(t){this.clearMoveShape();var e=this.node.convertToNodeSpaceAR(t.getLocation()),o=this.getCurrentShap(e);null!=o&&(this.m_moveShap=new Object,this.m_moveShap.position=o.position,this.m_moveShap.node=cc.instantiate(o.node),this.m_moveShap.node.x=e.x,this.m_moveShap.node.y=e.y+this.m_moveShap.position.height/2*64+64,this.m_moveShap.node.scale=1,this.node.addChild(this.m_moveShap.node),o.node.active=!1)},touchMove:function(t){if(null!=this.m_moveShap){var e=t.getLocation();e=this.node.convertToNodeSpaceAR(e),this.m_moveShap.node.x=e.x,this.m_moveShap.node.y=e.y+this.m_moveShap.position.height/2*64+64}},touchEnd:function(t){if(null!=this.m_moveShap){var e=this.m_moveShap.node.getPosition();e=this.node.convertToWorldSpaceAR(e),g_blockGroup.setShape(e,this.m_moveShap.node.children[0],this.m_moveShap.node.rotation,this.m_moveShap.position)?(this.clearMoveShape(),this.clearCurrentShape(),this.createNewShapes()):(this.showCurrentShape(),this.clearMoveShape()),this.checkCanContinue()||(cc.log("failed"),g_failed.show())}},checkCanContinue:function(){for(var t=0;t<this.m_shapes.length;t++)if(null!=this.m_shapes[t]&&g_blockGroup.canPut(this.m_shapes[t].position.checklist))return!0;return!1},touchCancel:function(t){this.showCurrentShape(),this.clearMoveShape()},showCurrentShape:function(){var t=this.m_shapes[this.m_currentIndex];null!=t&&(t.node.active=!0)},destroyAll:function(){if(null!=this.m_shapes)for(var t=0;t<this.m_shapes.length;t++)null!=this.m_shapes[t]&&(this.m_shapes[t].node.removeFromParent(),this.m_shapes[t].node.destroy(),this.m_shapes[t].node=null,this.m_shapes[t]=null);this.m_currentIndex=null,null!=this.m_moveShap&&(this.m_moveShap.node.removeFromParent(),this.m_moveShap.node.destroy(),this.m_moveShap.node=null,this.m_moveShap=null)}}),cc._RF.pop()},{}],blockGroup:[function(t,e,o){"use strict";cc._RF.push(e,"fd497ZUn+5NipwJJ+q8fXPW","blockGroup");var i=t("dataManager");cc.Class({extends:cc.Component,properties:{m_imageAtlas:cc.SpriteAtlas,m_score:cc.Label,m_scoreHistory:cc.Label},onLoad:function(){window.g_blockGroup=this,this.m_blockMap=new Array,this.m_scoreNum=0,this.dataManager=i(),this.init(),this.loadBlockGroup()},start:function(){this.dataManager.load(),this.m_scoreHistory.string=""+this.dataManager.getScore()},init:function(){for(var t=0;t<10;t++){this.m_blockMap[t]=new Array;for(var e=0;e<10;e++)this.m_blockMap[t][e]=null}},loadBlockGroup:function(){for(var t=0;t<10;t++)for(var e=64*t,o=0;o<10;o++){var i=64*o,a=new cc.Node;this.node.addChild(a),a.anchorX=0,a.anchorY=1,a.x=i,a.y=-e,a.scale=64/68;var s=a.addComponent(cc.Sprite),n=this.m_imageAtlas.getSpriteFrame("11");s.spriteFrame=n}},isNotInAvalibleArea:function(t,e){return!(t.x-64*e.width/2>=-32&&t.x+64*e.width/2<=672&&t.y+64*e.height/2<=32&&t.y-64*e.height/2>=-672)},checkPosition:function(t,e){if(t=this.node.convertToNodeSpaceAR(t),this.isNotInAvalibleArea(t,e))return!1;this.resetPosition(t,e);var o=Math.abs(t.x-e.center.x)/64,i=Math.abs(t.y-e.center.y)/64;this.m_checklist=[];for(var a=0;a<e.checklist.length;a++){var s=e.checklist[a].x+i,n=e.checklist[a].y+o;if(this.m_checklist[a]={x:s,y:n},null!=this.m_blockMap[s][n])return!1}return!0},setShape:function(t,e,o,i){return!!this.checkPosition(t,i)&&(this.setMapFlag(e,o),this.clearUp(),!0)},setMapFlag:function(t,e){for(var o=0;o<this.m_checklist.length;o++)if(null!=this.m_checklist[o]){var i=cc.instantiate(t);i.y=64*-this.m_checklist[o].x-32,i.x=64*this.m_checklist[o].y+32,i.rotation=e,i.width=56,i.height=56,this.m_blockMap[this.m_checklist[o].x][this.m_checklist[o].y]=i,this.node.addChild(i),this.updateScore(),this.m_checklist[o]=null}},resetPosition:function(t,e){if(e.width%2==0){var o=t.x%64;t.x=o>=32?64*Math.ceil(t.x/64):64*Math.floor(t.x/64)}else t.x=64*Math.floor(t.x/64)+32;if(e.height%2==0){var i=t.y%64;t.y=i<=-32?64*Math.floor(t.y/64):64*Math.ceil(t.y/64)}else t.y=64*Math.ceil(t.y/64)-32},clearUp:function(){for(var t=new Array,e=new Array,o=0;o<10;o++){for(var i=!0,a=0;a<10;a++)if(null==this.m_blockMap[o][a]){i=!1;break}i&&t.push(o)}for(var s=0;s<10;s++){i=!0;for(var n=0;n<10;n++)if(null==this.m_blockMap[n][s]){i=!1;break}i&&e.push(s)}for(;t.length>0;)for(var r=t.pop(),c=0;c<10;c++){if(null!=(p=this.m_blockMap[r][c])){var h=cc.callFunc(function(t,e){for(var o=0;o<10;o++)this.removeShap(e,o)},this,r);this.cleanUpAction(p,h,c,!0)}}for(;e.length>0;)for(var l=e.pop(),u=0;u<10;u++){var p;if(null!=(p=this.m_blockMap[u][l])){h=cc.callFunc(function(t,e){for(var o=0;o<10;o++)this.removeShap(o,e)},this,l);this.cleanUpAction(p,h,u,!1)}}},cleanUpAction:function(t,e,o,i){var a,s,n=cc.fadeTo(.3-.03*o,0);i?(s=cc.delayTime(.03*o),a=cc.moveBy(.3,cc.v2(0,-200))):(s=cc.delayTime(.03*(9-o)),a=cc.moveBy(.3,cc.v2(200,0)));var r=cc.sequence(s,cc.spawn(n,a));0==o&&(r=cc.sequence(r,e)),t.runAction(r)},removeShap:function(t,e){var o=this.m_blockMap[t][e];null!=o&&(this.updateScore(),o.removeFromParent(),this.m_blockMap[t][e]=null,o=null)},canPut:function(t){for(var e=0;e<10;e++)for(var o=0;o<10;o++)if(null==this.m_blockMap[e][o]){for(var i=Math.abs(t[0].x-e),a=Math.abs(o-t[0].y),s=!1,n=1;n<t.length;n++){var r=t[n].x+i,c=t[n].y+a;if(r<0||c<0||r>=10||c>=10||null!=this.m_blockMap[r][c]){s=!0;break}}if(!s)return!0}return!1},destroyAll:function(){for(var t=0;t<10;t++)for(var e=0;e<10;e++)if(null!=this.m_blockMap[t][e]){if(null==this.m_blockMap[t][e])continue;this.m_blockMap[t][e].removeFromParent(),this.m_blockMap[t][e].destroy(),this.m_blockMap[t][e]=null}if(null!=this.m_checklist)for(var o=0;o<this.m_checklist.lenght;o++)this.m_checklist[o]=null;this.m_score.string="0",this.m_scoreNum=0},updateScore:function(){this.m_scoreNum+=1,this.m_score.string=""+this.m_scoreNum;var t=this.dataManager.getScore();this.m_scoreNum>t&&(this.dataManager.updateScore(this.m_scoreNum),this.m_scoreHistory.string=""+this.m_scoreNum)}}),cc._RF.pop()},{dataManager:"dataManager"}],dataManager:[function(t,e,o){"use strict";cc._RF.push(e,"36ec5TYaxxExLKEmFQypR1m","dataManager"),e.exports=function(){var t=new Object;return t.userData={},t.load=function(){var e=cc.sys.localStorage.getItem("userData");t.userData=null!=e&&""!=e?JSON.parse(e):{score:0}},t.save=function(){var e=JSON.stringify(t.userData);cc.sys.localStorage.setItem("userData",e)},t.updateScore=function(e){t.userData.score=e,t.save()},t.getScore=function(){return null==t.userData.score&&(t.userData.score=0),t.userData.score},t},cc._RF.pop()},{}],failed:[function(t,e,o){"use strict";cc._RF.push(e,"2c881TQNENFEJ5Az8b2GIau","failed"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){window.g_failed=this,this.node.active=!1},start:function(){},show:function(){this.node.active=!0},restart:function(){g_backlogGroup.destroyAll(),g_blockGroup.destroyAll(),this.node.active=!1,g_backlogGroup.createShape()}}),cc._RF.pop()},{}],shapeBuilder:[function(t,e,o){"use strict";cc._RF.push(e,"bd2dfbUrVRL7oIvsK7Cznw9","shapeBuilder"),cc.Class({extends:cc.Component,properties:{m_shapeAtlas:cc.SpriteAtlas,m_shapes:[cc.Prefab],m_data:cc.JsonAsset},onLoad:function(){window.g_shapeBuilder=this,this.m_rotations=[0,270,180,90],this.m_typeProbability=[5,5,10,15,15,10,15,15,10],this.m_calcProbability=new Array},start:function(){for(var t=0;t<this.m_typeProbability.length;t++)0==t?this.m_calcProbability.push(this.m_typeProbability[t]):this.m_calcProbability.push(this.m_calcProbability[t-1]+this.m_typeProbability[t])},createShape:function(){var t=this.createTypeByProbability(),e=randomNum(0,3),o=cc.instantiate(this.m_shapes[t]);o.rotation=this.m_rotations[e],o.active=!0;var i=new Object;return i.node=o,i.position=this.m_data.json.shapes[t].positions[e],i},createTypeByProbability:function(){for(var t=randomNum(0,100),e=0;e<this.m_calcProbability.length;e++)if(t<=this.m_calcProbability[e])return e;return 0}}),cc._RF.pop()},{}],testGroup:[function(t,e,o){"use strict";cc._RF.push(e,"13e715i6k9K15x4WM/G+GAe","testGroup"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}]},{},["backlogGroup","blockGroup","dataManager","failed","shapeBuilder","testGroup"]);