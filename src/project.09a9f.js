window.__require=function e(t,o,i){function s(a,c){if(!o[a]){if(!t[a]){var r=a.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!c&&l)return l(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var h=o[a]={exports:{}};t[a][0].call(h.exports,function(e){return s(t[a][1][e]||e)},h,h.exports,e,t,o,i)}return o[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<i.length;a++)s(i[a]);return s}({configManager:[function(e,t,o){"use strict";cc._RF.push(t,"5dd2f/mh0hKZ5QpfcoyO6sB","configManager");var i=e("global");cc.Class({extends:cc.Component,properties:{shapeConfig:cc.JsonAsset,toolsConfig:cc.JsonAsset},onLoad:function(){i.config=this,this.shapeConfigData=this.shapeConfig.json,this.toolsConfigData=this.toolsConfig.json},start:function(){},getShapes:function(){return this.shapeConfigData.shapes},getRotations:function(){return this.shapeConfigData.rotations},getsingleBlockSize:function(){return this.shapeConfigData.singleBlockSize},getTools:function(){return{cleanTools:this.toolsConfigData.cleanTools,scoreTools:this.toolsConfigData.scoreTools}}}),cc._RF.pop()},{global:"global"}],dataManager:[function(e,t,o){"use strict";cc._RF.push(t,"36ec5TYaxxExLKEmFQypR1m","dataManager"),t.exports=function(){var e=new Object;return e.userData={},e.load=function(){var t=cc.sys.localStorage.getItem("userData");e.userData=null!=t&&""!=t?JSON.parse(t):{score:0}},e.save=function(){var t=JSON.stringify(e.userData);cc.sys.localStorage.setItem("userData",t)},e.updateScore=function(t){e.userData.score=t,e.save()},e.getScore=function(){return null==e.userData.score&&(e.userData.score=0),e.userData.score},e},cc._RF.pop()},{}],failed:[function(e,t,o){"use strict";cc._RF.push(t,"2c881TQNENFEJ5Az8b2GIau","failed");var i=e("global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.failed=this,this.node.zIndex=9999,this.node.active=!1},start:function(){},show:function(){this.node.active=!0,cc.log("failed")},restart:function(){i.sourceArea.destroyAll(),i.placedArea.destroyAll(),i.toolArea.destroyAll(),i.top.destroyAll(),i.sourceArea.refreshShapes(),this.node.active=!1}}),cc._RF.pop()},{global:"global"}],game:[function(e,t,o){"use strict";cc._RF.push(t,"2dde2R24ANMqY4Z26aVguBe","game");var i=e("global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.loader.loadResDir("prefab/gameUI",function(e,t){this.loadGameUI(t),this.registerFailedAction(),this.registerClearEndAction()}.bind(this))},start:function(){},loadGameUI:function(e){for(var t=0;t<e.length;t++){var o=cc.instantiate(e[t]);this.node.addChild(o)}},registerFailedAction:function(){i.movedArea.registerTouchEndEvent(function(){for(var e=i.toolArea.getHammers(),t=0;t<e.length;t++)if(0!=e[t].value)return;for(var o=i.sourceArea.getShapes(),s=0;s<o.length;s++)if(null!=o[s]&&i.placedArea.canPlaced(o[s].data.checklist))return;i.failed.show()})},registerClearEndAction:function(){i.placedArea.registerClearEndActions(function(e,t,o,s){var n=e.length+t.length;i.toolArea.addTool(n,o,s)})}}),cc._RF.pop()},{global:"global"}],global:[function(e,t,o){"use strict";cc._RF.push(t,"c04f1TIcE9JSY6cC6EVg8KX","global"),t.exports={config:null,shapeBuilder:null,sourceArea:null,placedArea:null,movedArea:null,top:null,toolArea:null,failed:null},cc._RF.pop()},{}],movedArea:[function(e,t,o){"use strict";cc._RF.push(t,"66268ITDi1AAqpuW96AJdbB","movedArea");var i=e("global");cc.Class({extends:cc.Component,properties:{space:{default:100,type:cc.Integer}},onLoad:function(){i.movedArea=this,this.touchEndActions=new Array,this.node.zIndex=999,this.movingElement=null,this.currentType,cc.macro.ENABLE_MULTI_TOUCH=!1,this.node.on("touchstart",this.touchStart,this),this.node.on("touchmove",this.touchMove,this),this.node.on("touchend",this.touchEnd,this),this.node.on("touchcancel",this.touchCancel,this)},start:function(){this.singleBlockSize=i.config.getsingleBlockSize()},touchStart:function(e){this.destroyMovingElement();var t=e.getLocation();if(i.sourceArea.isInside(t))this.currentType="shape",this.movingElement=this.createMovingShape(t),this.node.addChild(this.movingElement.node),i.sourceArea.hideShape(this.movingElement.sourceIndex);else if(i.toolArea.isInside(t)){if(this.currentType="tool",this.movingElement=this.createMovingShape(t),null==this.movingElement)return;this.node.addChild(this.movingElement.node),cc.log("tools")}else cc.log("no")},touchMove:function(e){if(null!=this.movingElement){var t=e.getLocation();t=this.node.convertToNodeSpaceAR(t),this.movingElement.node.x=t.x,"shape"==this.currentType?this.movingElement.node.y=t.y+this.movingElement.data.offsetY+this.space:"tool"==this.currentType&&(this.movingElement.node.y=t.y+this.space)}},touchEnd:function(e){null!=this.movingElement&&("shape"==this.currentType?this.processShape():"tool"==this.currentType&&this.processTool(),this.destroyMovingElement())},touchCancel:function(e){null!=this.movingElement&&(i.sourceArea.showShape(this.movingElement.sourceIndex),this.destroyMovingElement())},destroyMovingElement:function(){null!=this.movingElement&&(this.movingElement.node.removeFromParent(),this.movingElement.node=null,this.movingElement=null)},createMovingShape:function(e){var t=new Object,o=null;if("shape"==this.currentType){o=i.sourceArea.getShape(e),t.data=o.data,t.sourceIndex=o.sourceIndex,t.node=cc.instantiate(o.node),t.node.scale=.95;var s=i.sourceArea.node.width/3;t.node.x=o.sourceIndex*s+s/2,e=this.node.convertToNodeSpaceAR(e),t.data.offsetY=this.singleBlockSize.height*o.data.height/2,t.node.y=e.y+t.data.offsetY+this.space}else if("tool"==this.currentType){if(!(o=i.toolArea.getHammer(e)).data.enabled)return void(this.movingElement=null);t.data=o.data,t.node=cc.instantiate(o.hammer),t.sourceIndex=o.sourceIndex,t.type=o.bigType,t.node.scale=.8;s=i.toolArea.node.width/o.data.count;t.node.x=o.sourceIndex*s+s/2,e=this.node.convertToNodeSpaceAR(e),t.node.y=e.y+this.space}return t},processShape:function(){var e=this.movingElement.node.getPosition();e=this.node.convertToWorldSpaceAR(e),i.placedArea.place(e,this.movingElement.data)?(i.sourceArea.destroyShape(this.movingElement.sourceIndex),this.doTouchEndAction()):i.sourceArea.showShape(this.movingElement.sourceIndex)},registerTouchEndEvent:function(e){this.touchEndActions.push(e)},doTouchEndAction:function(){for(var e=0;e<this.touchEndActions.length;e++)this.touchEndActions[e]()},processTool:function(){var e=this.movingElement.node.getPosition();e=this.node.convertToWorldSpaceAR(e),i.placedArea.toolClean(e,this.movingElement.data)&&(i.toolArea.subHammer(this.movingElement.type,this.movingElement.sourceIndex),this.doTouchEndAction())}}),cc._RF.pop()},{global:"global"}],placedArea:[function(e,t,o){"use strict";cc._RF.push(t,"f0cd2x/3BlMybTD48NS98RM","placedArea");var i=e("global");cc.Class({extends:cc.Component,properties:{rowCount:{default:10,type:cc.Integer},colCount:{default:10,type:cc.Integer},placedElement:cc.Prefab,placedBlock:cc.Prefab},onLoad:function(){i.placedArea=this,this.placedMap=new Array,this.clearEndActions=new Array,this.oldScore=0},start:function(){this.singleBlockSize=i.config.getsingleBlockSize(),this.spaceX=this.singleBlockSize.width/2,this.spaceY=this.singleBlockSize.height/2,this.loadPlacedBlocks()},loadPlacedBlocks:function(){for(var e=0;e<this.rowCount;e++){for(var t=new Array,o=0;o<this.colCount;o++){var i=this.createPlacedBlock(this.singleBlockSize.width,this.singleBlockSize.height,e,o);this.node.addChild(i);var s=this.createChild(i);i.addChild(s),s.active=!1,t[o]=i}this.placedMap[e]=t}},createPlacedBlock:function(e,t,o,i){var s=cc.instantiate(this.placedBlock);return s.width=e,s.height=t,s.x=i*e,s.y=-o*t,s},createChild:function(e){var t=cc.instantiate(this.placedElement);return t.width=e.width-6,t.height=e.height-6,t.x=3,t.y=-3,t},place:function(e,t){this.oldScore=i.top.getScore(),e=this.node.convertToNodeSpaceAR(e);var o=t.width,s=t.height;if(!this.validateArea(e,o,s))return!1;e=this.resetPosition(e,o,s);var n=this.getPlacedPosition(t.center,e,t.checklist);return!!this.validateSpace(n)&&(this.placeElement(n),this.clearFulled(n),!0)},validateArea:function(e,t,o){return e.x-t/2*this.singleBlockSize.width>=-this.spaceX&&e.x+t/2*this.singleBlockSize.width<=this.spaceX+this.node.width&&e.y+o/2*this.singleBlockSize.height<=this.spaceY&&e.y-o/2*this.singleBlockSize.height>=-this.spaceY-this.node.height},resetPosition:function(e,t,o){return e.x=this.resetPositionX(e.x,t),e.y=this.resetPositionY(e.y,o),e},resetPositionX:function(e,t){var o=0;t%2==0?o=e%this.singleBlockSize.width>=this.singleBlockSize.width/2?Math.ceil(e/this.singleBlockSize.width):Math.floor(e/this.singleBlockSize.width):o=Math.floor(e/this.singleBlockSize.width)+.5;return o*this.singleBlockSize.width},resetPositionY:function(e,t){var o=0;t%2==0?o=e%this.singleBlockSize.height<=-this.singleBlockSize.height/2?Math.floor(e/this.singleBlockSize.height):Math.ceil(e/this.singleBlockSize.height):o=Math.ceil(e/this.singleBlockSize.height)-.5;return o*this.singleBlockSize.height},getOffset:function(e,t){return{col:(t.x-e.x*this.singleBlockSize.width)/this.singleBlockSize.width,row:(e.y*this.singleBlockSize.height-t.y)/this.singleBlockSize.height}},validateSpace:function(e){for(var t=e.rows,o=e.cols,i=0;i<t.length;i++)if(this.placedMap[t[i]][o[i]].children[0].active)return!1;return!0},placeElement:function(e){for(var t=e.rows,o=e.cols,s=0;s<t.length;s++)this.placedMap[t[s]][o[s]].children[0].active=!0,i.top.addScore(1)},getPlacedPosition:function(e,t,o){for(var i=new Array,s=new Array,n=this.getOffset(e,t),a=0;a<o.length;a++){var c=o[a],r=c.row+n.row,l=c.col+n.col;i.push(r),s.push(l)}return{rows:i,cols:s}},clearFulled:function(e){for(var t=this.getNeedToClearPositions(e.rows,e.cols),o=0;o<t.rows.length;o++)this.clearRow(t.rows[o]);for(var s=0;s<t.cols.length;s++)this.clearCol(t.cols[s]);this.doEndActions(t.rows,t.cols,this.oldScore,i.top.getScore())},doEndActions:function(e,t,o,i){for(var s=0;s<this.clearEndActions.length;s++)this.clearEndActions[s](e,t,o,i)},getNeedToClearPositions:function(e,t){for(var o=new Array,i=new Array,s=0;s<e.length;s++)this.isRowFull(e[s])&&!array_contain(o,e[s])&&o.push(e[s]),this.isColFull(t[s])&&!array_contain(i,t[s])&&i.push(t[s]);return{rows:o,cols:i}},isRowFull:function(e){for(var t=0;t<this.colCount;t++)if(!this.placedMap[e][t].children[0].active)return!1;return!0},clearRow:function(e){for(var t=0;t<this.colCount;t++)1==this.placedMap[e][t].children[0].active&&(this.placedMap[e][t].children[0].active=!1,i.top.addScore(1))},isColFull:function(e){for(var t=0;t<this.colCount;t++)if(!this.placedMap[t][e].children[0].active)return!1;return!0},clearCol:function(e){for(var t=0;t<this.colCount;t++)1==this.placedMap[t][e].children[0].active&&(this.placedMap[t][e].children[0].active=!1,i.top.addScore(1))},canPlaced:function(e){for(var t=0;t<this.rowCount;t++)for(var o=0;o<this.colCount;o++)if(!(this.placedMap[t][o].children[0].active||t<e[0].row||o<e[0].col)){for(var i=t-e[0].row,s=o-e[0].col,n=!0,a=1;a<e.length;a++){var c=e[a].row+i,r=e[a].col+s;if(c>=this.rowCount||r>=this.colCount||this.placedMap[c][r].children[0].active){n=!1;break}}if(n)return!0}return!1},destroyAll:function(){for(var e=0;e<this.rowCount;e++)for(var t=0;t<this.colCount;t++)this.placedMap[e][t].children[0].active=!1},registerClearEndActions:function(e){this.clearEndActions.push(e)},toolClean:function(e,t){var o=this.node.convertToNodeSpaceAR(e),i=t.height,s=t.width;if(o.x+=s/2,o.y-=i/2,!this.validateHammerArea(o,s,i))return!1;var n=this.getHammerPos(o,t);return this.cleanShapes(n,t.type)},getHammerPos:function(e,t){return{col:Math.floor(e.x/this.singleBlockSize.width),row:Math.floor(Math.abs(e.y)/this.singleBlockSize.height)}},validateHammerArea:function(e){return e.x>=0&&e.x<=this.node.width&&e.y<=0&&e.y>=-this.node.height},cleanShapes:function(e,t){if(0==this.placedMap[e.row][e.col].children[0].active)return!1;switch(t){case"single":this.cleanSingle(e.row,e.col);break;case"block":this.cleanBlock(e.row,e.col);break;case"line":this.cleanLine(e.row,e.col);break;case"cross":this.cleanCross(e.row,e.col)}return!0},cleanSingle:function(e,t){e>=0&&e<this.rowCount&&t>=0&&t<this.colCount&&1==this.placedMap[e][t].children[0].active&&(this.placedMap[e][t].children[0].active=!1,i.top.addScore(1))},cleanBlock:function(e,t){this.cleanSingle(e,t),this.cleanSingle(e,t-1),this.cleanSingle(e,t+1),this.cleanSingle(e-1,t),this.cleanSingle(e-1,t-1),this.cleanSingle(e-1,t+1),this.cleanSingle(e+1,t),this.cleanSingle(e+1,t-1),this.cleanSingle(e+1,t+1)},cleanLine:function(e,t){0==randomNum(0,1)?this.clearRow(e):this.clearCol(t)},cleanCross:function(e,t){this.clearRow(e),this.clearCol(t)}}),cc._RF.pop()},{global:"global"}],shapeBuilder:[function(e,t,o){"use strict";cc._RF.push(t,"bd2dfbUrVRL7oIvsK7Cznw9","shapeBuilder");var i=e("global");cc.Class({extends:cc.Component,properties:{shapePool:[cc.Prefab]},onLoad:function(){i.shapeBuilder=this,this.calcProbability=new Array,this.maxProbability=0},start:function(){this.shapesData=i.config.getShapes(),this.rotations=i.config.getRotations(),this.initializeCalcProbability()},initializeCalcProbability:function(){for(var e=0;e<this.shapesData.length;e++)this.maxProbability+=this.shapesData[e].probability,0==e?this.calcProbability.push(this.shapesData[e].probability):this.calcProbability.push(this.calcProbability[e-1]+this.shapesData[e].probability)},createShape:function(){var e=this.createTypeByProbability(),t=randomNum(0,this.rotations.length-1),o=new Object;return o.data=this.shapesData[e].positions[t],o.node=this.createNode(e,t,o.data),o},createNode:function(e,t){var o=cc.instantiate(this.shapePool[e]);return o.rotation=this.rotations[t],o.active=!0,o},createTypeByProbability:function(){for(var e=randomNum(0,this.maxProbability),t=0;t<this.calcProbability.length;t++)if(e<=this.calcProbability[t])return t;return 0}}),cc._RF.pop()},{global:"global"}],sourceArea:[function(e,t,o){"use strict";cc._RF.push(t,"2b5a1veXRlBdppubFdPu2KE","sourceArea");var i=e("global");cc.Class({extends:cc.Component,properties:{blockNum:{default:3,type:cc.Integer}},onLoad:function(){i.sourceArea=this,this.shapes=new Array,this.loadArea()},start:function(){},loadArea:function(){cc.loader.loadRes("prefab/block",function(e,t){for(var o=this.node.width/this.blockNum,i=this.node.height,s=0;s<this.blockNum;s++){var n=cc.instantiate(t);n.width=o,n.height=i,n.x=s*o,this.node.addChild(n),this.addShape(n,s)}}.bind(this))},addShape:function(e,t){var o=i.shapeBuilder.createShape();o.sourceIndex=t,o.node.x=this.node.width/this.blockNum/2,o.node.y=-this.node.height/2,this.shapes[t]=o,o.node.scale=.5,e.addChild(o.node)},isInside:function(e){var t=this.node.convertToNodeSpaceAR(e);return t.x>=0&&t.x<=this.node.width&&t.y<=0&&t.y>=-this.node.height},getShape:function(e){var t=this.node.convertToNodeSpaceAR(e),o=Math.floor(t.x/(this.node.width/this.blockNum));return this.shapes[o]},hideShape:function(e){e<0||e>=this.blockNum||(this.shapes[e].node.active=!1)},showShape:function(e){e<0||e>=this.blockNum||(this.shapes[e].node.active=!0)},destroyShape:function(e){e<0||e>=this.blockNum||null==this.shapes[e]||(this.shapes[e].node.removeFromParent(),this.shapes[e].node=null,this.shapes[e]=null,this.isNeedRefresh()&&this.refreshShapes())},isNeedRefresh:function(){for(var e=0;e<this.shapes.length;e++)if(null!=this.shapes[e])return!1;return!0},refreshShapes:function(){for(var e=0;e<this.node.children.length;e++)this.addShape(this.node.children[e],e)},getShapes:function(){return this.shapes},clearShapes:function(){for(var e=0;e<this.shapes.length;e++)null!=this.shapes[e]&&(this.shapes[e].node.removeFromParent(),this.shapes[e].node=null,this.shapes[e]=null)},destroyAll:function(){this.clearShapes()}}),cc._RF.pop()},{global:"global"}],testGroup:[function(e,t,o){"use strict";cc._RF.push(t,"13e715i6k9K15x4WM/G+GAe","testGroup");var i=e("global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){},onClickCreateShape:function(){var e=i.shapeBuilder.createShape();this.node.addChild(e.node)},onClickGetShape:function(){var e=i.sourceArea.getShape();this.node.addChild(e.node)}}),cc._RF.pop()},{global:"global"}],toolArea:[function(e,t,o){"use strict";cc._RF.push(t,"892d8khsLdPXJCC1eQ5u94+","toolArea");var i=e("global");cc.Class({extends:cc.Component,properties:{singleHammerLabel:cc.Label,blockHammerLabel:cc.Label,lineHammerLabel:cc.Label,crossHammerLabel:cc.Label,singleHammer:cc.Node,blockHammer:cc.Node,lineHammer:cc.Node,crossHammer:cc.Node},onLoad:function(){i.toolArea=this,this.cleanTools=new Array,this.scoreTools=new Array},start:function(){var e=i.config.getTools(),t=e.cleanTools,o=e.scoreTools;this.cleanTools.push({label:this.singleHammerLabel,value:0,hammer:this.singleHammer,type:"single",threshold:t[0].threshold,max:t[0].max}),this.cleanTools.push({label:this.lineHammerLabel,value:0,hammer:this.lineHammer,type:"line",threshold:t[1].threshold,max:t[1].max}),this.scoreTools.push({label:this.blockHammerLabel,value:0,hammer:this.blockHammer,type:"block",threshold:o[0].threshold,max:o[0].max}),this.scoreTools.push({label:this.crossHammerLabel,value:0,hammer:this.crossHammer,type:"cross",threshold:o[1].threshold,max:o[1].max})},addTool:function(e,t,o){0!=e&&(this.addCleanHammerIndex(e),this.addScoreHammerIndex(t,o))},addCleanHammerIndex:function(e){for(var t=0;t<this.cleanTools.length;t++)e==this.cleanTools[t].threshold&&this.addHammer(this.cleanTools[t])},addScoreHammerIndex:function(e,t){for(var o=0;o<this.scoreTools.length;o++){var i=this.scoreTools[o].threshold;Math.floor(t/i)>Math.floor(e/i)&&this.addHammer(this.scoreTools[o])}},subHammer:function(e,t){var o;"clean"==e?o=this.cleanTools[t]:"score"==e&&(o=this.scoreTools[t]),o.value>0&&(o.value--,o.label.string=o.value+"",0==o.value&&(o.hammer.parent.opacity=150))},addHammer:function(e){e.value<e.max&&(e.value++,e.label.string=e.value+"",e.hammer.parent.opacity=255)},isInside:function(e){var t=this.node.convertToNodeSpaceAR(e);return t.x>=0&&t.x<=this.node.width&&t.y<=-20&&t.y>=-this.node.height},getHammer:function(e){var t,o=this.node.convertToNodeSpaceAR(e),i=Math.floor(o.x/(this.node.width/4));return i>1?(i-=this.cleanTools.length,(t=this.scoreTools[i]).bigType="score"):(t=this.cleanTools[i]).bigType="clean",t.sourceIndex=i,t.data=new Object,t.data.height=70,t.data.width=70,t.data.type=t.type,t.data.enabled=t.value>0,t},destroyAll:function(){for(var e=0;e<this.tools.length;e++)this.tools[e].value=0,this.tools[e].label.string="0",this.tools[e].hammer.parent.opacity=150},getHammers:function(){for(var e=new Array,t=0;t<this.cleanTools.length;t++)e.push(this.cleanTools[t]);for(var o=0;o<this.scoreTools.length;o++)e.push(this.scoreTools[o]);return e}}),cc._RF.pop()},{global:"global"}],top:[function(e,t,o){"use strict";cc._RF.push(t,"b52627zJ59NaLfcnCQhcqRP","top");var i=e("global"),s=e("dataManager");cc.Class({extends:cc.Component,properties:{scoreLabel:cc.Label,scoreHistoryLabel:cc.Label},onLoad:function(){i.top=this,this.dataManager=s(),this.scoreNum=this.scoreHistoryNum=0},start:function(){this.dataManager.load(),this.loadHistoryScore()},onClickSetting:function(){this.showSettingModel()},addScore:function(e){this.scoreNum+=e,this.scoreLabel.string=this.scoreNum+"",this.scoreNum>this.scoreHistoryNum&&this.updateScoreHistory()},updateScoreHistory:function(){this.scoreHistoryNum=this.scoreNum,this.scoreHistoryLabel.string=this.scoreHistoryNum+"",this.dataManager.updateScore(this.scoreHistoryNum)},loadHistoryScore:function(){this.scoreHistoryNum=this.dataManager.getScore(),this.scoreHistoryLabel.string=this.scoreHistoryNum+""},showSettingModel:function(){i.failed.show()},getScore:function(){return this.scoreNum},destroyAll:function(){this.scoreNum=0,this.scoreLabel.string=this.scoreNum+""}}),cc._RF.pop()},{dataManager:"dataManager",global:"global"}],weicome:[function(e,t,o){"use strict";cc._RF.push(t,"768a9IKRSRK26HvmuxrdwR1","weicome"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.director.preloadScene("game",function(){cc.log("Next scene preloaded")})},start:function(){},onClickStartGame:function(){cc.director.loadScene("game")}}),cc._RF.pop()},{}]},{},["configManager","dataManager","failed","game","global","movedArea","placedArea","shapeBuilder","sourceArea","testGroup","toolArea","top","weicome"]);